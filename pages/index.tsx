import Head from 'next/head'
import {Inter} from 'next/font/google'
import React, {useEffect} from "react";
import AuthPage from "@/pages/Auth";
import {useSelectorWithType} from "@/hooks/useSelectorWithType";
import {useRouter} from "next/router";
import {getBalanceThunk} from "@/store/reducers/mainReducer";
import {useDispatchWithType} from "@/hooks/useDispatchWithType";
import {mainApi} from "@/axios/main";
import {Errors} from "@/types/constants";
import {logoutThunk, logoutWithErrorThunk, setAuth} from "@/store/reducers/authReducer";

const inter = Inter({subsets: ['latin']})


const Home = () => {
    const router = useRouter()
    const dispatch = useDispatchWithType()
    const {isAuth} = useSelectorWithType(state => state.auth)

    useEffect(() => {
        mainApi.getBalance().then(() => dispatch(setAuth(true))).catch(e => {
            if (e == Errors.NOT_AUTHORIZED) dispatch(logoutWithErrorThunk())
        })
    }, [])
    useEffect(() => {
        if (isAuth) router.push('/Main')
    }, [isAuth])

    return (
        <>
            <Head>
                <title>Create Next App</title>
                <meta name="description" content="Generated by create next app"/>
                <meta name="viewport" content="width=device-width, initial-scale=1"/>
                <link rel="icon" href="/favicon.ico"/>
            </Head>
            <AuthPage/>
        </>
    )
}
export default Home